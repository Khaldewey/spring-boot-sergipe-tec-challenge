<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Transferência</title>
</head>
<body>
    <h1>Transferir entre Contas</h1>

    <form th:action="@{/dashboard/transfer}" method="post">
        <div style="display: flex;">
            <div>
                <label for="senderAccountDropdown">Conta de Origem:</label>
                <select id="senderAccountDropdown" name="senderAccountId" onchange="updateHiddenFields('senderAccountDropdown', 'hiddenSenderAccountType'); updateRecipientDropdown();">
                    <option disabled selected>Selecione a conta de origem</option>
                    <th:block th:each="account : ${currentAccounts}">
                        <option th:value="${account.id}" th:data-type="current"
                            th:text="'Conta Corrente ' + ${account.id} + ' - Saldo: ' + ${account.saldo}"></option>
                    </th:block>
                    <th:block th:each="account : ${savingAccounts}">
                        <option th:value="${account.id}" th:data-type="saving"
                            th:text="'Conta Poupança ' + ${account.id} + ' - Saldo: ' + ${account.saldo}"></option>
                    </th:block>
                </select>
                <input type="hidden" name="senderAccountType" id="hiddenSenderAccountType">
            </div>

            <div>
                <label for="recipientAccountDropdown">Conta de Destino:</label>
                <select id="recipientAccountDropdown" name="recipientAccountId" onchange="updateHiddenFields('recipientAccountDropdown', 'hiddenRecipientAccountType')">
                    <option disabled selected>Selecione a conta de destino</option>
                    <th:block th:each="account : ${currentAccounts}">
                        <option th:value="${account.id}" th:data-type="current"
                            th:text="'Conta Corrente ' + ${account.id} + ' - Saldo: ' + ${account.saldo}"></option>
                    </th:block>
                    <th:block th:each="account : ${savingAccounts}">
                        <option th:value="${account.id}" th:data-type="saving"
                            th:text="'Conta Poupança ' + ${account.id} + ' - Saldo: ' + ${account.saldo}"></option>
                    </th:block>
                </select>
                <input type="hidden" name="recipientAccountType" id="hiddenRecipientAccountType">
            </div>
        </div>

        <div>
            <label for="transferValue">Valor a Transferir:</label>
            <input type="number" id="transferValue" name="transferValue" min="0" step="0.01" required>
        </div>

        <button type="submit">Transferir</button>
    </form>
    <div th:if="${errorMessage}">
        <p style="color: red;" th:text="${errorMessage}"></p>
    </div>
    
    <div th:if="${message}">
        <p style="color: green;" th:text="${message}"></p>
    </div>

    <a href="/dashboard">Voltar</a>

    <script>
       
        function updateHiddenFields(dropdownId, hiddenFieldId) {
            const dropdown = document.getElementById(dropdownId);
            const selectedOption = dropdown.options[dropdown.selectedIndex];
            const accountType = selectedOption.getAttribute('data-type');
            document.getElementById(hiddenFieldId).value = accountType;
        }

        
        function updateRecipientDropdown() {
            const senderDropdown = document.getElementById('senderAccountDropdown');
            const recipientDropdown = document.getElementById('recipientAccountDropdown');
            
           
            const selectedSenderId = senderDropdown.value;

            
            for (let i = 0; i < recipientDropdown.options.length; i++) {
                const option = recipientDropdown.options[i];
                
                if (option.value === selectedSenderId) {
                    option.style.display = 'none'; 
                } else {
                    option.style.display = 'block'; 
                }
            }
        }
    </script>
</body>
</html>
